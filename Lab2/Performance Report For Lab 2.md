# Performance Report For Lab 2

## 一、实验内容

实现一个HTTP服务器，分为Basic和Advanced两个难度。

### 1.1 问题描述

从头开始实现HTTP服务器(基于HTTP/1.1)，并且满足对应的要求，并通过高并发编程技巧来保证Web服务器的性能。

### 1.2 我们的工作

成功实现了Basic和Advanced级别，具体参看正确性验证部分内容

### 1.3 其他说明

按照实验要求输入从而启动服务器，输入quit可以退出服务器

## 二、实验测试

### 2.1正确性测试

- 3.1.6：服务器可以根据给定的参数完成配置后运行。
- 3.1.7.1：web 浏览器访问服务器可以看到相关网页。
- 3.1.7.1.2：使用curl程序发送HTTP请求可以得到相应的响应报文。
- 3.1.7.1.3：果请求页面不存在，则HTTP服务器应返回404 Not Found错误消息
- 3.1.7.2.1：使用curl程序发送HTTP请求来检查POST方法是否有效，POST可以按要求运行。
- 3.1.7.2.2：如果请求URL不是`/Post_show`或键不是“名称”和“ ID”），则会收到404 Not Found错误消息。
- 3.1.7.3： 除GET请求和POST请求外，HTTP服务器将不处理HTTP请求。

### 2.2 性能测试

#### 2.2.1 测试方法

使用 HTTP 客户端测试工具 [ab-Apache HTTP服务器基准测试工具](http://httpd.apache.org/docs/current/programs/ab.html)

测试了在不同的并发请求数、不同的客户请求数下：

1. 在不同的计算机环境上运行服务器时，不同并发数的服务器的情况；
2. 在多台计算机上运行客户端并同时访问一台计算机上运行的服务端的情况；
3. 在代理模式下不同的计算机环境上运行服务器时，不同并发访问情况；

#### 2.2.2 实验环境

| 用户 |      OS      |                            CPU                            | RAM（Used/Total） |
| :--: | :----------: | :-------------------------------------------------------: | :---------------: |
| LYH  | Ubuntu 20.04 |   11th Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz（8核）   |   981Mb/3908Mb    |
| LHZ  | Ubuntu 20.04 | 10th Gen Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz（2核） |   1633Mb/3906Mb   |
| ZZQ  | Ubuntu 20.04 |   11th Gen Intel(R) Core(TM) i7-8550U @ 1.80GHz（8核）    |   804Mb/3908Mb    |

### 3.正确性测试

#### 2.2.3 性能分析

##### 测试一 不同的计算机环境上运行服务器时，不同线程数的服务器

![test1](F:\作业\大三下\云计算\实验2\test1)

由于虚拟机的缘故，服务器每秒可以处理HTTP请求数有很大的差异，但是在不同的并发条件下似乎对性能没有太多的影响，即每秒钟处理的请求数基本不变，与机器的配置有关。

##### 测试二 采用线程池且不同的线程数量下，不同并发测得的处理效率

<img src="F:\作业\大三下\云计算\实验2\test2" alt="test2" style="zoom: 80%;" />

###### 分析

值得一提的是，我们的10线程版本是在服务器端是包含输出的请求信息的输出，所以占用了很多的性能，但是由于输出非常耗时，我们将输出注释掉之后，性能将近提高了一倍。

而且我们提供了两个版本，即多线程版本（自己设计多个线程及其工作模式进行协作）和线程池（依旧是多个线程池），在线程池版本中增加线程池到100后性能接近峰值为每秒钟可以处理6000余条请求。

而且可以看到在所有的不同线程的情况下，在不不断增大的并发访问量下，服务器每秒可以处理HTTP请求数最后趋于一个极限，随着服务器线程数的增加，服务器的处理能力提高，但当并发访问过多时，超出服务器的处理能力也有可能会导致服务器每秒可以处理HTTP请求数下降。并且并发超过一定限度的同时，会导致大量拥塞，从而导致访问超时。

##### 测试三 代理模式下不同的计算机环境上运行服务器时，不同线程数

<img src="F:\作业\大三下\云计算\实验2\test3" alt="test3" style="zoom:80%;" />

###### 分析

与不使用代理时服务器每秒可以处理HTTP请求数的变化类似，但是在高并发访问量的时候，相比不使用代理会造成更高的丢包率，更高的丢包会导致服务器看似每秒处理HTTP请求数增高，但根据低并发访问量的情况来看，还是在不使用代理时更快一些，大多数情况下几乎是不使用代理时候的两倍。